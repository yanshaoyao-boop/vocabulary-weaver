<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
  <defs>
    <linearGradient id="hatGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#8B4513"/>
      <stop offset="50%" stop-color="#654321"/>
      <stop offset="100%" stop-color="#3d2817"/>
    </linearGradient>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#740001"/>
      <stop offset="100%" stop-color="#4a0001"/>
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>
  
  <!-- Background circle -->
  <circle cx="256" cy="256" r="250" fill="url(#bgGrad)" stroke="#eeba30" stroke-width="8"/>
  
  <!-- Sorting Hat body -->
  <path d="M 140 380 
           C 120 380, 100 360, 110 340
           L 130 320
           C 140 310, 160 305, 180 310
           L 200 280
           C 210 260, 230 250, 250 260
           L 270 200
           C 280 160, 300 120, 340 100
           C 360 90, 380 95, 385 110
           C 390 130, 370 160, 350 200
           L 330 250
           C 340 260, 360 270, 370 290
           L 390 320
           C 400 335, 395 360, 370 380
           Z" 
        fill="url(#hatGrad)" 
        stroke="#3d2817" 
        stroke-width="3"/>
  
  <!-- Hat brim -->
  <ellipse cx="255" cy="385" rx="130" ry="30" fill="#654321" stroke="#3d2817" stroke-width="2"/>
  <ellipse cx="255" cy="380" rx="125" ry="25" fill="#8B4513"/>
  
  <!-- Hat fold lines -->
  <path d="M 180 330 Q 220 340, 260 325" stroke="#3d2817" stroke-width="2" fill="none"/>
  <path d="M 200 300 Q 250 310, 300 290" stroke="#3d2817" stroke-width="2" fill="none"/>
  <path d="M 250 250 Q 280 260, 320 240" stroke="#3d2817" stroke-width="2" fill="none"/>
  
  <!-- Magical sparkles -->
  <g fill="#eeba30" filter="url(#glow)">
    <circle cx="120" cy="150" r="4"/>
    <circle cx="400" cy="180" r="5"/>
    <circle cx="100" cy="280" r="3"/>
    <circle cx="420" cy="300" r="4"/>
    <circle cx="150" cy="420" r="3"/>
    <circle cx="380" cy="430" r="4"/>
    <circle cx="450" cy="230" r="3"/>
    <circle cx="80" cy="350" r="4"/>
  </g>
  
  <!-- Small stars -->
  <g fill="#ffd700">
    <polygon points="120,140 122,146 128,146 123,150 125,156 120,152 115,156 117,150 112,146 118,146" transform="scale(0.8)"/>
    <polygon points="480,200 482,206 488,206 483,210 485,216 480,212 475,216 477,210 472,206 478,206" transform="scale(0.7)"/>
  </g>
</svg>
